<?php
// $Id: user.test,v 1.111 2010/12/18 00:56:18 dries Exp $

/**
 * @file
 * simpletest for ldap aservers
 *
 */

class LdapServersTestCase extends DrupalWebTestCase {
  public static function getInfo() {
    return array(
      'name' => 'LDAP Servers Tests',
      'description' => 'Test ldap servers.  Servers module is primarily a storage
        tool for ldap server configuration, so most of testing is just form and db testing.
        there are some api like functions that could be tested.',
      'group' => 'LDAP'
    );
  }

  public $module_name = 'ldap_servers';

  protected $ldap_test_data;

  /**
   *  create one or more server configurations in such as way
   *  that this setUp can be a prerequisite for ldap_authentication and ldap_authorization
   */
  function setUp() {
    $this->ldap_user = $this->drupalCreateUser();
    $this->drupal_user = $this->drupalCreateUser();
    $this->drupal_admin_user = $this->drupalCreateUser(array('administer site configuration'));

    $parent = dirname(dirname($_SERVER['SCRIPT_FILENAME']));
    $delimiter = (strpos(@$_SERVER['SERVER_SOFTWARE'], 'Microsoft') === FALSE) ? '/' : '\\';
    require_once($parent . $delimiter . 'ldap_simpletest.inc');
    $this->ldap_test_data = ldap_simpletest_conf();

    // create 2 ldap server configurations based on configuration files
    // set ldap general configuration:  encryption, detailed logging,
  }


  function testInstall() {
    $group = 'ldap_servers: install and uninstall';
    // disable, uninstall, and enable/install module
    $modules = array($this->module_name);
    module_disable($modules, TRUE); // disable dependent modules
    drupal_uninstall_modules($modules);
    module_enable($modules, TRUE);
    $var_created = $this->assertTrue(db_table_exists($table), 'ldap_servers table creates', $group);
    $var_created = $this->assertTrue(variable_get('ldap_servers_encryption', FALSE), 'ldap_servers_encryption variable initialized', $group);
    $var_created = $this->assertTrue(variable_get('ldap_servers_encrypt_key', FALSE), 'ldap_servers_encrypt_key variable initialized', $group);

    module_disable($modules, TRUE); // disable dependent modules
    drupal_uninstall_modules($modules);
    $var_created = $this->assertFalse(db_table_exists($table), 'ldap_servers table removed', $group);
    $var_created = $this->assertFalse(variable_get('ldap_servers_encryption', FALSE), 'ldap_servers_encryption variable removed', $group);
    $var_created = $this->assertFalse(variable_get('ldap_servers_encrypt_key', FALSE), 'ldap_servers_encrypt_key variable removed', $group);


    }


  function testEncryption() {
    // test that pwds in config files are encrypted.
    // test that switching encryption, decrypes and reincrypts pwd.
  }

  function testHttps() {
    // enable https required
    // get logon form over http and see if disabled
  }




  function testServerCRUD() {
    // add, edit, and delete a server.
    // test critical validations
    // test if server object can be instantiated from server record
  }

  function testLdap() {
    // test some basic ldap functions just to see if ldap connection is real.



  }

  function testAPIFunctions() {
    // test some functions in the api


  }


}
